<!DOCTYPE html>
<html>
    <head>
        <title>JS Framework</title>
        <link href="assets/css/style.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Lato:400,900' rel='stylesheet' type='text/css'>
        <script src="https://dependencies.arnaud-nicolas.fr/?need=Template.es6,M4Tween"></script>
        <script type="application/json" id="routing_rules">
{
    "home":
    {
        "hash":"home",
        "controller":"IndexController",
        "action":"defaultAction",
        "default":true
    },
    "bouboup":
    {
        "hash":"bouboup",
        "controller":"IndexController",
        "action":"secondAction"
    },
    "withParameters":
    {
        "hash":"foo/{$id_bar}/{$permalink}",
        "controller":"IndexController",
        "action":"secondAction",
        "parameters":
        {
            "id_bar":"[0-9]+",
            "permalink":"[a-z0-9\\-\\_]+"
        }
    }
}
        </script>
        <script src="js/fw.js"></script>
        <script>
            "use strict";
            var transitions = {
                generic:{
                    in:function()
                    {
                        let completeHandler = function(){
                            this.dispatchEvent(event);
                        };
                        var event = new Event(FwJs.lib.events.TRANSITION_IN);
                        M4Tween.to(document.querySelector('h1'),.3, {opacity:1, marginLeft:"0px"})
                                .onComplete(completeHandler.bind(this));
                    },
                    out:function()
                    {
                        let completeHandler = function(){
                            this.dispatchEvent(event);
                        };
                        var event = new Event(FwJs.lib.events.TRANSITION_OUT);
                        M4Tween.to(document.querySelector('h1'),.3, {opacity:0, marginLeft:"-30px"})
                                .onComplete(completeHandler.bind(this));
                    }
                }
            };

            class IndexController extends FwJs.lib.DefaultController
            {
                constructor()
                {
                    super();
                    this.transitions = transitions;
                }

                defaultAction()
                {
                    console.log("default");
                    this.dispatchEvent(new Event(FwJs.lib.events.RENDER));
                }

                secondAction(pParameters)
                {
                    console.log("secondAction");
                    if(pParameters)
                    {
                        console.log(pParameters);

                        console.log(FwJs.lib.tools.rewriteHash('withParameters', pParameters));
                    }
                    this.dispatchEvent(new Event(FwJs.lib.events.RENDER));
                }
            }

            FwJs.newController(IndexController);

            window.addEventListener('load', FwJs.start);
        </script>
    </head>
    <body>
        <menu>
            <li><a href="#home">Home</a></li>
            <li><a href="#bouboup">Second Page</a></li>
        </menu>
        <div id="container"></div>
        <div id="loader"></div>
        <script type="text/template" id="IndexController_defaultAction_tpl">
        <h1 style="opacity: 0;margin-left:-30px;">Hello Framework</h1>
        </script>
        <script type="text/template" id="IndexController_secondAction_tpl">
            <h1 style="opacity: 0;margin-left:-30px;">Hell yeah</h1>
        </script>
    </body>
</html>
